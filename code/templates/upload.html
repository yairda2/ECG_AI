<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Image to MongoDB</title>
    <style>
        /* Style for the image preview */
        #image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px; /* Reduced height for a smaller preview */
            border: 2px solid #ccc;
            margin: 10px 0;
        }

        #image-preview {
            max-width: 100%;
            max-height: 100%;
        }

        /* Style for active (selected) buttons */
        .valid-button.active {
            background-color: green; /* Green for Valid */
            color: white;
            font-weight: bold;
        }

        .invalid-button.active {
            background-color: red; /* Red for Invalid */
            color: white;
            font-weight: bold;
        }
    </style>
    <script>
        // Function to display the selected image in the preview window
        function previewImage() {
            var preview = document.getElementById('image-preview');
            var fileInput = document.getElementById('image');

            var file = fileInput.files[0];

            if (file) {
                preview.src = URL.createObjectURL(file);  // Use createObjectURL to display the image
            } else {
                preview.src = '';  // Clear the preview if no file is selected
            }
        }

        // Function to set the validity value and toggle button colors
        function setValidity(value) {
            var validity = document.getElementById('validity');
            var validButton = document.querySelector('.valid-button');
            var invalidButton = document.querySelector('.invalid-button');

            if (value === 'valid') {
                validity.value = 'valid';
                validButton.classList.add('active');
                invalidButton.classList.remove('active');
            } else {
                validity.value = 'invalid';
                invalidButton.classList.add('active');
                validButton.classList.remove('active');
            }
        }

        // Initialize the button colors based on the initial validity value
        window.onload = function () {
            var initialValidity = document.getElementById('validity').value;
            var validButton = document.querySelector('.valid-button');
            var invalidButton = document.querySelector('.invalid-button');

            if (initialValidity === 'valid') {
                validButton.classList.add('active');
            } else {
                invalidButton.classList.add('active');
            }
        }
    </script>
</head>
<body>
    <h1>Upload Image to MongoDB</h1>

    <form method="POST" enctype="multipart/form-data">
        <label for="image">Select an image or PDF:</label>
        <input type="file" name="image" id="image" accept=".png, .jpg, .jpeg, .pdf, .gif, .bmp, .tiff, .svg" required onchange="previewImage()"><br>

        <!-- Image preview container -->
        <div id="image-container">
            <img id="image-preview" src="" alt="Image Preview">
        </div>

        <!-- Buttons for Valid/Invalid selection -->
        <label for="validity">Choose Validity:</label>
        <input type="hidden" name="validity" id="validity" value="valid"> <!-- Initialize with 'valid' -->
        <button type="button" class="valid-button" onclick="setValidity('valid')">Valid</button>
        <button type="button" class="invalid-button" onclick="setValidity('invalid')">Invalid</button><br>

        <!-- Add 10 input fields for reasons of invalidity -->
        <label for="reasons">Reasons for Invalidity:</label><br>
        {% for i in range(1, 11) %}
            <textarea name="reason{{ i }}" rows="3" cols="50"></textarea><br>
        {% endfor %}

        <input type="submit" value="Upload">
    </form>

    <div>
        <h2>Images in MongoDB</h2>
        <!-- Display the images stored in MongoDB here -->
        {% for image in images %}
            <p>{{ image.filename }} - Validity: {{ image.validity }} - Reasons: {{ image.reasons }}</p>
            <img src="data:{{ image.content_type }};base64,{{ image.image_data }}" alt="{{ image.filename }} Preview">
        {% endfor %}
    </div>
</body>
</html>
