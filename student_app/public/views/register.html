<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
    <link rel="stylesheet" type="text/css" href="/css/common.css"> <!-- Assuming you have some CSS for styling -->
</head>
<style>
    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1000; /* Sit on top - high z-index */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    .modal-content {
        position: relative;
        background-color: #fefefe;
        margin: 10% auto; /* 10% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 50%; /* 50% of window width */
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2); /* Shadow for 3D effect */
    }

    /* The Close Button */
    .close {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 25px;
        font-size: 35px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .form-container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
        background-color: #f9f9f9;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
    }

    .form-group input,
    .form-group select,
    .form-group button {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .radio-group {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .radio-group label {
        margin-right: 10px;
    }
</style>

<body>

<!-- Main Page and Info Buttons -->
<button id="mainpageButton" class="icon-button">Home</button>
<button id="infoButton" class="icon-button">User Info</button>
<button id="loginButton" class="icon-button" onclick="window.location.href='/login'">Login</button>

<div class="form-container">
    <h1>Register</h1>
    <form id="registerForm">
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <div class="form-group">
            <label>Gender:</label>
            <div class="radio-group">
                <label for="male">Male</label>
                <input type="radio" id="male" name="gender" value="male" required>

                <label for="female">Female</label>
                <input type="radio" id="female" name="gender" value="female" required>

                <label for="unspecified">Unspecified</label>
                <input type="radio" id="unspecified" name="gender" value="unspecified" required>
            </div>
        </div>

        <div class="form-group">
            <label for="academicInstitution">Academic Institution:</label>
            <select id="academicInstitution" name="academicInstitution" required>
                <option value="">Select an institution</option>
                <option value="Ariel University in Samaria">Ariel University in Samaria</option>
                <option value="Ben Gurion University in the Negev">Ben Gurion University in the Negev</option>
                <option value="Bar-Ilan University">Bar-Ilan University</option>
                <option value="Haifa University">Haifa University</option>
                <option value="Reichman University">Reichman University</option>
                <option value="Tel Aviv University">Tel Aviv University</option>
                <option value="Al Qasmi - Academic College of Education">Al Qasmi - Academic College of Education</option>
                <option value="Amunah-Afrata - Academic College of Arts and Education">Amunah-Afrata - Academic College of Arts and Education</option>
                <option value="Afka - the Academic College of Engineering in Tel Aviv">Afka - the Academic College of Engineering in Tel Aviv</option>
                <option value="Bezalel - Jerusalem Academy of Art and Design">Bezalel - Jerusalem Academy of Art and Design</option>
                <option value="Hebrew University of Jerusalem">Hebrew University of Jerusalem</option>
                <option value="The Open University">The Open University</option>
                <option value="The Academy of Music and Dance in Jerusalem">The Academy of Music and Dance in Jerusalem</option>
                <option value="The Technion - Israeli Institute of Technology">The Technion - Israeli Institute of Technology</option>
                <option value="Ahva Academic College">Ahva Academic College</option>
                <option value="Ashkelon Academic College">Ashkelon Academic College</option>
                <option value="Wingate Academic College">Wingate Academic College</option>
                <option value="Beit Berl College">Beit Berl College</option>
                <option value="West Galilee Academic College">West Galilee Academic College</option>
                <option value="Hadassah Academic College Jerusalem">Hadassah Academic College Jerusalem</option>
                <option value="The Shanan Religious Academic College for Education">The Shanan Religious Academic College for Education</option>
                <option value="The Arab Academic College of Education in Israel - Haifa">The Arab Academic College of Education in Israel - Haifa</option>
                <option value="The Herzog Academic College was founded by Lifshitz and Herzog Colleges">The Herzog Academic College was founded by Lifshitz and Herzog Colleges</option>
                <option value="The academic college is greedy">The academic college is greedy</option>
                <option value="Kinneret Academic College">Kinneret Academic College</option>
                <option value="Baruda Academic College of Engineering in Karmiel">Baruda Academic College of Engineering in Karmiel</option>
                <option value="The Sami Shimon Academic College of Engineering">The Sami Shimon Academic College of Engineering</option>
                <option value="Washington Hill Academic College of Education">Washington Hill Academic College of Education</option>
                <option value="The Academic College for Education and Sports Ohlo in Katsrin">The Academic College for Education and Sports Ohlo in Katsrin</option>
                <option value="A. D. Gordon Academic College of Education">A. D. Gordon Academic College of Education</option>
                <option value="David Yelin Academic College of Education">David Yelin Academic College of Education</option>
                <option value="The Academic College of Education named after Kay">The Academic College of Education named after Kay</option>
                <option value="Netanya Academic College">Netanya Academic College</option>
                <option value="Sapir Academic College">Sapir Academic College</option>
                <option value="Emek Jezreel Max Stern Academic College">Emek Jezreel Max Stern Academic College</option>
                <option value="Safed Academic College">Safed Academic College</option>
                <option value="Ramat Gan Academic College">Ramat Gan Academic College</option>
                <option value="Tel Hai Academic College">Tel Hai Academic College</option>
                <option value="Tel Aviv Jaffa Academic College">Tel Aviv Jaffa Academic College</option>
                <option value="The College of Administration academic track">The College of Administration academic track</option>
                <option value="Lev Academic Center">Lev Academic Center</option>
                <option value="Levinsky-Wingate Academic Center">Levinsky-Wingate Academic Center</option>
                <option value="The Academic Center for Law and Business">The Academic Center for Law and Business</option>
                <option value="The Academic Center for Design and Education Witzo - Haifa by Neri Bloomfield">The Academic Center for Design and Education Witzo - Haifa by Neri Bloomfield</option>
                <option value="Peres Academic Center">Peres Academic Center</option>
                <option value="Ruppin Academic Center">Ruppin Academic Center</option>
                <option value="The academic center is complete">The academic center is complete</option>
                <option value="Shaari Science and Law Academic Center">Shaari Science and Law Academic Center</option>
                <option value="Ono Academic College">Ono Academic College</option>
                <option value="Weitzman Institution of Science">Weitzman Institution of Science</

                option>
                <option value="Holon Institute of Technology - HIT">Holon Institute of Technology - HIT</option>
                <option value="Schechter Institute for Jewish Studies">Schechter Institute for Jewish Studies</option>
                <option value="Oranim Academic College of Education">Oranim Academic College of Education</option>
                <option value="Academic College of Education - Orot Israel from the foundation of the Orot Israel College and the Yaakov Heritage College">Academic College of Education - Orot Israel from the foundation of the Orot Israel College and the Yaakov Heritage College</option>
                <option value="Jerusalem College">Jerusalem College</option>
                <option value="Lewinsky College of Education">Lewinsky College of Education</option>
                <option value="Sakhnin College for the Training of Teaching Staff">Sakhnin College for the Training of Teaching Staff</option>
                <option value="The Kibbutzim Seminar - College of Education for Technology and the Arts">The Kibbutzim Seminar - College of Education for Technology and the Arts</option>
                <option value="Azrieli - Jerusalem Academic College of Engineering">Azrieli - Jerusalem Academic College of Engineering</option>
                <option value="Shankar engineering. Design. art">Shankar engineering. Design. art</option>
                <option value="Talpiot - Academic College of Education">Talpiot - Academic College of Education</option>
            </select>
        </div>

        <div class="form-group">
            <label for="avgDegree">Average Degree:</label>
            <input type="number" step="0.01" id="avgDegree" name="avgDegree" required>
        </div>
        <div class="form-group">
            <label for="age">Age:</label>
            <input type="number" id="age" name="age" min="1" required>
        </div>

        <div class="form-group">
            <button type="button" id="showTermsButton">Show Terms of Use</button> <!-- Changed to type="button" -->
            <label for="termsAgreeCheckbox">I agree to the terms and conditions</label>
            <input type="checkbox" id="termsAgreeCheckbox" name="termsAgreement" required>
        </div>

        <button type="submit">Register</button>
    </form>
    <div id="message"></div>
</div>

<!-- Terms Modal outside of the form -->
<div id="termsModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Terms of Use</h2>
        <p id="termsContent">Loading terms...</p>
    </div>
</div>

<script>
    document.getElementById('showTermsButton').addEventListener('click', function() {
        fetch('/terms', { method: 'GET' })
            .then(response => response.text())
            .then(text => {
                document.getElementById('termsContent').innerHTML = text;
                document.getElementById("termsModal").style.display = "block";
            })
            .catch(error => {
                document.getElementById('termsContent').innerHTML = "Failed to load terms.";
                console.error('Error fetching terms:', error);
            });
    });

    // Close the modal when the user clicks on (x)
    document.querySelector('.close').addEventListener('click', function() {
        document.getElementById("termsModal").style.display = "none";
    });

    // Close the modal if the user clicks outside of it
    window.onclick = function(event) {
        var modal = document.getElementById("termsModal");
        if (event.target == modal) {
            modal.style.display = "none";
        }
    };

    document.getElementById('registerForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const gender = document.querySelector('input[name="gender"]:checked').value;
        const avgDegree = parseFloat(document.getElementById('avgDegree').value);
        const age = parseInt(document.getElementById('age').value);
        const academicInstitution = document.getElementById('academicInstitution').value;
        const termsAgreement = document.getElementById('termsAgreeCheckbox').checked;

        fetch('/register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({email, password, age, gender, avgDegree, academicInstitution, termsAgreement})
        })
            .then(response => {
                if (response.status === 409) {
                    // Redirect to login page
                    window.location.href = '/login';
                } else if (response.status === 200) {
                    // Handle successful registration
                    alert('Registration successful!');
                    window.location.href = '/login';
                } else {
                    return response.text().then(text => {
                        throw new Error(text)
                    });
                }
            })
            .catch(error => alert('Error: ' + error.message));
    });
</script>
</body>
</html>
```